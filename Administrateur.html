<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Tontine Enseignants - Administration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
            --radius: 24px;
            --radius-sm: 16px;
            --radius-xs: 12px;
        }

        /* Écran de connexion */
        .login-container {
            background: white;
            border-radius: var(--radius);
            padding: 40px 30px;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-container h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), #9333ea);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .login-form .form-group {
            margin-bottom: 24px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
            font-size: 0.95rem;
        }

        .login-form input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-xs);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), #9333ea);
            color: white;
            border: none;
            padding: 16px;
            border-radius: var(--radius-xs);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow-md);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            filter: brightness(1.1);
        }

        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 16px;
            font-size: 0.95rem;
            padding: 12px;
            background: #fee2e2;
            border-radius: var(--radius-xs);
            display: none;
        }

        /* Application principale */
        .container {
            display: none;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), #9333ea);
            color: white;
            padding: 30px;
            position: relative;
        }

        .app-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .app-header .description {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 600px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
        }

        .section {
            background: #f8fafc;
            border-radius: var(--radius-sm);
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-light);
        }

        .section h2 {
            color: var(--dark);
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2 i {
            color: var(--primary);
        }

        /* Formulaire d'ajout */
        .teacher-form {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
            margin-bottom: 24px;
        }

        .teacher-form .form-group {
            flex: 1;
            min-width: 250px;
        }

        .teacher-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }

        .teacher-form input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-xs);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .teacher-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            min-width: 160px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: #0d9488;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--accent);
            color: white;
        }

        .btn-warning:hover {
            background: #ea580c;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-purple {
            background: #9333ea;
            color: white;
        }

        .btn-purple:hover {
            background: #7e22ce;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray-light);
            color: var(--dark);
        }

        .btn-outline:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        .btn-info {
            background: #06b6d4;
            color: white;
        }

        .btn-info:hover {
            background: #0891b2;
            transform: translateY(-2px);
        }

        /* Grille des enseignants */
        .teacher-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .teacher-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-light);
            transition: all 0.3s;
        }

        .teacher-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .teacher-card strong {
            font-size: 1.1rem;
            color: var(--dark);
            display: block;
            margin-bottom: 10px;
        }

        .teacher-card small {
            color: var(--gray);
            font-size: 0.9rem;
            display: block;
            margin-bottom: 5px;
        }

        .teacher-badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .group-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .group-1000 {
            background: #dbeafe;
            color: #1e40af;
        }

        .group-2000 {
            background: #dcfce7;
            color: #166534;
        }

        .group-5000 {
            background: #fed7aa;
            color: #9a3412;
        }

        .group-10000 {
            background: #e9d5ff;
            color: #6b21a8;
        }

        /* Filtres */
        .filter-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            background: white;
            padding: 20px;
            border-radius: var(--radius-sm);
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .filter-item {
            flex: 1;
            min-width: 200px;
        }

        .filter-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }

        .filter-item select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-xs);
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .filter-item select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Tableaux */
        .table-responsive {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: var(--radius-sm);
            background: white;
            box-shadow: var(--shadow-sm);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 16px 12px;
            font-weight: 600;
            text-align: left;
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--gray-light);
        }

        tr:hover {
            background: #f1f5f9;
        }

        /* Détails enseignant */
        .teacher-details {
            background: white;
            border-radius: var(--radius-sm);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-light);
        }

        .teacher-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .teacher-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .summary-card {
            background: #f8fafc;
            border-radius: var(--radius-xs);
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid var(--primary);
        }

        .summary-card p {
            margin: 8px 0;
            color: var(--dark);
        }

        /* Graphiques */
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-md);
        }

        .chart-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .chart-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-light);
        }

        .chart-card h4 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-card h4 i {
            color: var(--primary);
        }

        canvas {
            max-height: 300px;
            max-width: 100%;
        }

        /* Messages */
        .success-message, .error-container {
            padding: 16px 20px;
            border-radius: var(--radius-xs);
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--secondary);
        }

        .error-container {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }

        /* Auto-save indicator */
        .auto-save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 20px;
            border-radius: 40px;
            box-shadow: var(--shadow-lg);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--gray-light);
            backdrop-filter: blur(8px);
            z-index: 100;
        }

        .auto-save-status i {
            color: var(--secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .app-header {
                padding: 20px;
            }

            .app-header h1 {
                font-size: 1.6rem;
            }

            .app-header .description {
                font-size: 0.95rem;
                margin-bottom: 60px;
            }

            .logout-btn {
                top: 15px;
                right: 15px;
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            .content {
                padding: 20px;
            }

            .teacher-form {
                flex-direction: column;
            }

            .teacher-form .form-group {
                width: 100%;
            }

            .btn {
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            .filter-section {
                flex-direction: column;
                gap: 12px;
            }

            .filter-item {
                width: 100%;
            }

            .teacher-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .teacher-header button {
                width: 100%;
            }

            .chart-row {
                grid-template-columns: 1fr;
            }

            .auto-save-status {
                bottom: 10px;
                right: 10px;
                font-size: 0.8rem;
                padding: 8px 16px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .teacher-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .chart-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Impression */
        @media print {
            .no-print, .logout-btn, .btn, .filter-section, .auto-save-status, .teacher-header button {
                display: none !important;
            }

            body {
                background: white;
                padding: 0;
            }

            .container {
                display: block !important;
            }

            .main-card {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .app-header {
                background: white;
                color: black;
                border-bottom: 2px solid #333;
            }

            .section {
                break-inside: avoid;
                border: 1px solid #ddd;
                background: white;
            }

            table {
                border-collapse: collapse;
                width: 100%;
            }

            th {
                background: #f0f0f0 !important;
                color: black !important;
            }
            
            canvas {
                max-height: 200px;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Écran de connexion -->
    <div class="login-container" id="loginContainer">
        <h2><i class="fas fa-hand-holding-usd"></i> Tontine Admin</h2>
        <form class="login-form" onsubmit="event.preventDefault(); login();">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Identifiant</label>
                <input type="text" id="username" placeholder="Entrez votre identifiant" required>
            </div>
            <div class="form-group">
                <label><i class="fas fa-lock"></i> Mot de passe</label>
                <input type="password" id="password" placeholder="Entrez votre mot de passe" required>
            </div>
            <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Se connecter
            </button>
            <div class="error-message" id="loginError">
                <i class="fas fa-exclamation-circle"></i> Identifiant ou mot de passe incorrect
            </div>
        </form>
    </div>

    <!-- Application principale -->
    <div class="container" id="appContainer">
        <div class="main-card">
            <!-- En-tête -->
            <div class="app-header">
                <h1><i class="fas fa-chalkboard-teacher"></i> Gestion de Tontine Enseignants</h1>
                <p class="description">Générateur de programme de tontine équitable pour 10 enseignants avec 4 groupes de cotisation</p>
                <button class="logout-btn no-print" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>

            <!-- Contenu -->
            <div class="content">
                <!-- Messages -->
                <div class="success-message" id="successMessage">
                    <i class="fas fa-check-circle"></i> <span></span>
                </div>
                <div class="error-container" id="errorMessage">
                    <i class="fas fa-exclamation-triangle"></i> <span></span>
                </div>

                <!-- Section Enregistrement -->
                <div class="section">
                    <h2><i class="fas fa-user-plus"></i> Enregistrement des Enseignants</h2>
                    
                    <div class="teacher-form">
                        <div class="form-group">
                            <label for="teacherName">Nom et Prénom de l'Enseignant</label>
                            <input type="text" id="teacherName" placeholder="Ex: DUPONT Jean">
                        </div>
                        <button class="btn btn-primary" onclick="addTeacher()">
                            <i class="fas fa-plus-circle"></i> Ajouter
                        </button>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-danger" onclick="resetData()">
                            <i class="fas fa-trash-alt"></i> Tout supprimer
                        </button>
                        <button class="btn btn-warning" onclick="saveData()">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button class="btn btn-success" onclick="loadData()">
                            <i class="fas fa-folder-open"></i> Charger
                        </button>
                    </div>

                    <div id="teacherList" class="teacher-grid"></div>
                </div>

                <!-- Section Génération -->
                <div class="section no-print">
                    <h2><i class="fas fa-cogs"></i> Génération du Programme</h2>
                    <p class="description">Après avoir ajouté 10 enseignants, vous pourrez générer le programme de tontine.</p>
                    <div class="button-group">
                        <button class="btn btn-purple" onclick="generateProgram()" id="generateBtn" disabled>
                            <i class="fas fa-play"></i> Générer le Programme
                        </button>
                        <button class="btn btn-info" onclick="exportAllToCSV()" id="exportBtn" disabled>
                            <i class="fas fa-file-csv"></i> Exporter en CSV
                        </button>
                    </div>
                </div>

                <!-- Section Programme -->
                <div class="section" id="programSection" style="display: none;">
                    <div class="button-group no-print">
                        <button class="btn btn-success" onclick="window.print()">
                            <i class="fas fa-print"></i> Imprimer tout
                        </button>
                        <button class="btn btn-purple" onclick="printFilteredTeachers()">
                            <i class="fas fa-user-print"></i> Imprimer filtrés
                        </button>
                        <button class="btn btn-info" onclick="exportAllToCSV()">
                            <i class="fas fa-file-csv"></i> Exporter CSV
                        </button>
                        <button class="btn btn-danger" onclick="resetData()">
                            <i class="fas fa-trash-alt"></i> Réinitialiser
                        </button>
                    </div>

                    <h2><i class="fas fa-filter"></i> Filtres</h2>
                    <div class="filter-section no-print">
                        <div class="filter-item">
                            <label for="teacherFilter"><i class="fas fa-user"></i> Enseignant</label>
                            <select id="teacherFilter" onchange="filterByTeacher()">
                                <option value="all">Tous les enseignants</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label for="monthFilter"><i class="fas fa-calendar"></i> Mois</label>
                            <select id="monthFilter" onchange="filterByMonth()">
                                <option value="all">Tous les mois</option>
                                <option value="1">Mois 1</option>
                                <option value="2">Mois 2</option>
                                <option value="3">Mois 3</option>
                                <option value="4">Mois 4</option>
                                <option value="5">Mois 5</option>
                                <option value="6">Mois 6</option>
                                <option value="7">Mois 7</option>
                                <option value="8">Mois 8</option>
                                <option value="9">Mois 9</option>
                                <option value="10">Mois 10</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label for="groupFilter"><i class="fas fa-money-bill"></i> Groupe</label>
                            <select id="groupFilter" onchange="filterByGroup()">
                                <option value="all">Tous les groupes</option>
                                <option value="1000">1000 FCFA</option>
                                <option value="2000">2000 FCFA</option>
                                <option value="5000">5000 FCFA</option>
                                <option value="10000">10000 FCFA</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section des graphiques globaux -->
                    <div class="chart-container no-print" id="globalCharts" style="display: none;">
                        <h3><i class="fas fa-chart-pie"></i> Statistiques globales</h3>
                        <div class="chart-row">
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-bar"></i> Répartition par groupe</h4>
                                <canvas id="globalGroupChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-line"></i> Évolution mensuelle</h4>
                                <canvas id="globalMonthlyChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="teacherDetails"></div>
                    
                    <h2><i class="fas fa-table"></i> Programme de Tontine</h2>
                    <div id="programOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicateur de sauvegarde -->
    <div class="auto-save-status no-print" id="autoSaveIndicator">
        <i class="fas fa-sync-alt fa-spin"></i> Sauvegarde automatique
    </div>

    <script>
        // Configuration
        const CORRECT_USERNAME = "KOLA";
        const CORRECT_PASSWORD = "KOLA1@";
        const TOTAL_TEACHERS = 10;
        
        // Variables globales
        let teachers = [];
        let programGenerated = false;
        let currentFilter = {
            teacher: 'all',
            month: 'all',
            group: 'all'
        };
        let autoSaveInterval = null;
        
        // Références des graphiques
        let teacherCharts = {};

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            startAutoSave();
            hideAutoSaveIndicator();
        });

        function hideAutoSaveIndicator() {
            document.getElementById('autoSaveIndicator').style.display = 'none';
        }

        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.style.display = 'flex';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        function checkAuth() {
            const isLoggedIn = localStorage.getItem('tontineLoggedIn');
            if (isLoggedIn === 'true') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadData();
            }
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === CORRECT_USERNAME && password === CORRECT_PASSWORD) {
                localStorage.setItem('tontineLoggedIn', 'true');
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadData();
                showMessage('Connexion réussie !', true);
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            localStorage.removeItem('tontineLoggedIn');
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                if (teachers.length > 0) {
                    saveData();
                    showAutoSaveIndicator();
                }
            }, 30000);
        }

        function showMessage(message, isSuccess = true) {
            const msgElement = isSuccess ? 
                document.getElementById('successMessage') : 
                document.getElementById('errorMessage');
            const span = msgElement.querySelector('span');
            span.textContent = message;
            msgElement.style.display = 'block';
            
            if (isSuccess) {
                setTimeout(() => {
                    msgElement.style.display = 'none';
                }, 3000);
            }
        }

        function addTeacher() {
            const nameInput = document.getElementById('teacherName');
            const name = nameInput.value.trim();
            
            if (name === '') {
                showMessage('Veuillez entrer un nom', false);
                return;
            }
            
            if (teachers.length >= TOTAL_TEACHERS) {
                showMessage(`Maximum ${TOTAL_TEACHERS} enseignants atteint`, false);
                return;
            }
            
            teachers.push({
                id: teachers.length + 1,
                name: name,
                identifier: `PROF${String(teachers.length + 1).padStart(3, '0')}`,
                password: `Tontine@${String(teachers.length + 1).padStart(2, '0')}`,
                gains1000: 0,
                gains2000: 0,
                gains5000: 0,
                gains10000: 0,
                collections: []
            });
            
            updateTeacherList();
            nameInput.value = '';
            
            if (teachers.length === TOTAL_TEACHERS) {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('exportBtn').disabled = false;
                document.getElementById('generateBtn').classList.add('pulse');
            }
            
            showMessage('Enseignant ajouté avec succès');
            saveData();
        }

        function updateTeacherList() {
            const teacherList = document.getElementById('teacherList');
            teacherList.innerHTML = '';
            
            teachers.forEach(teacher => {
                const card = document.createElement('div');
                card.className = 'teacher-card';
                card.innerHTML = `
                    <strong><i class="fas fa-user-circle"></i> ${teacher.name}</strong>
                    <small><i class="fas fa-id-card"></i> ID: ${teacher.identifier}</small>
                    <small><i class="fas fa-key"></i> Mot de passe: ${teacher.password}</small>
                    <div class="teacher-badges">
                        <span class="group-badge group-1000">1000F</span>
                        <span class="group-badge group-2000">2000F</span>
                        <span class="group-badge group-5000">5000F</span>
                        <span class="group-badge group-10000">10000F</span>
                    </div>
                `;
                teacherList.appendChild(card);
            });
        }

        function saveData() {
            try {
                const dataToSave = {
                    teachers: teachers,
                    programGenerated: programGenerated
                };
                localStorage.setItem('tontineData', JSON.stringify(dataToSave));
                console.log('Données sauvegardées');
            } catch (error) {
                console.error('Erreur de sauvegarde', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('tontineData');
                if (!savedData) {
                    showMessage('Aucune donnée sauvegardée', false);
                    return;
                }
                
                const parsedData = JSON.parse(savedData);
                teachers = parsedData.teachers || [];
                programGenerated = parsedData.programGenerated || false;
                
                updateTeacherList();
                
                if (teachers.length === TOTAL_TEACHERS) {
                    document.getElementById('generateBtn').disabled = false;
                    document.getElementById('exportBtn').disabled = false;
                }
                
                if (programGenerated) {
                    generateProgram();
                }
                
                showMessage('Données chargées avec succès !');
            } catch (error) {
                showMessage('Erreur de chargement', false);
            }
        }

        function resetData() {
            if (confirm('Êtes-vous sûr de vouloir supprimer toutes les données ?')) {
                teachers = [];
                programGenerated = false;
                document.getElementById('teacherList').innerHTML = '';
                document.getElementById('generateBtn').disabled = true;
                document.getElementById('exportBtn').disabled = true;
                document.getElementById('generateBtn').classList.remove('pulse');
                document.getElementById('programSection').style.display = 'none';
                document.getElementById('teacherName').value = '';
                document.getElementById('teacherFilter').innerHTML = '<option value="all">Tous les enseignants</option>';
                document.getElementById('teacherDetails').innerHTML = '';
                document.getElementById('programOutput').innerHTML = '';
                
                localStorage.removeItem('tontineData');
                showMessage('Données réinitialisées');
            }
        }

        function generateProgram() {
            if (teachers.length !== TOTAL_TEACHERS) {
                showMessage('Veuillez ajouter exactement 10 enseignants', false);
                return;
            }

            // Ordres prédéfinis pour l'équité
            const group1000Order = [3, 8, 1, 6, 9, 4, 10, 5, 2, 7];
            const group2000Order = [7, 2, 4, 10, 5, 9, 3, 6, 8, 1];
            const group5000Order = [10, 5, 7, 3, 2, 8, 1, 9, 6, 4];
            const group10000Order = [1, 9, 6, 5, 4, 7, 2, 10, 3, 8];

            // Réinitialiser les gains
            teachers.forEach(teacher => {
                teacher.gains1000 = 0;
                teacher.gains2000 = 0;
                teacher.gains5000 = 0;
                teacher.gains10000 = 0;
                teacher.collections = [];
            });

            let programHTML = `
                <div class="table-responsive">
                    <h3><i class="fas fa-key"></i> Identifiants et mots de passe</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Enseignant</th>
                                <th>Identifiant</th>
                                <th>Mot de passe</th>
                                <th>Groupes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            teachers.forEach(teacher => {
                programHTML += `
                    <tr>
                        <td>${teacher.name}</td>
                        <td>${teacher.identifier}</td>
                        <td>${teacher.password}</td>
                        <td>
                            <span class="group-badge group-1000">1000F</span>
                            <span class="group-badge group-2000">2000F</span>
                            <span class="group-badge group-5000">5000F</span>
                            <span class="group-badge group-10000">10000F</span>
                        </td>
                    </tr>
                `;
            });

            programHTML += `</tbody></table></div>`;

            // Générer les tableaux pour chaque groupe
            programHTML += generateGroupTable('1000 FCFA', '10 000 FCFA', group1000Order, 1000);
            programHTML += generateGroupTable('2000 FCFA', '20 000 FCFA', group2000Order, 2000);
            programHTML += generateGroupTable('5000 FCFA', '50 000 FCFA', group5000Order, 5000);
            programHTML += generateGroupTable('10000 FCFA', '100 000 FCFA', group10000Order, 10000);

            // Récapitulatif des gains
            programHTML += `
                <div class="table-responsive">
                    <h3><i class="fas fa-chart-bar"></i> Récapitulatif des gains</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Enseignant</th>
                                <th>Gains totaux</th>
                                <th>Détail</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            teachers.forEach(teacher => {
                const total = (teacher.gains1000 || 0) + (teacher.gains2000 || 0) + 
                             (teacher.gains5000 || 0) + (teacher.gains10000 || 0);
                const details = [];
                if (teacher.gains1000) details.push(`${teacher.gains1000}F (1000F)`);
                if (teacher.gains2000) details.push(`${teacher.gains2000}F (2000F)`);
                if (teacher.gains5000) details.push(`${teacher.gains5000}F (5000F)`);
                if (teacher.gains10000) details.push(`${teacher.gains10000}F (10000F)`);
                
                programHTML += `
                    <tr>
                        <td>${teacher.name}</td>
                        <td><strong>${total.toLocaleString()} FCFA</strong></td>
                        <td>${details.join(' + ')}</td>
                    </tr>
                `;
            });

            programHTML += `</tbody></table></div>`;

            document.getElementById('programOutput').innerHTML = programHTML;
            document.getElementById('programSection').style.display = 'block';
            
            // Mettre à jour le filtre des enseignants
            const teacherFilter = document.getElementById('teacherFilter');
            teacherFilter.innerHTML = '<option value="all">Tous les enseignants</option>';
            teachers.forEach(teacher => {
                teacherFilter.innerHTML += `<option value="${teacher.id}">${teacher.name}</option>`;
            });
            
            programGenerated = true;
            showTeacherDetails();
            createGlobalCharts();
            saveData();
            
            // Animation de défilement
            document.getElementById('programSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateGroupTable(groupName, collectionAmount, order, groupValue) {
            let tableHTML = `
                <div class="table-responsive">
                    <h3><i class="fas fa-users"></i> Groupe ${groupName} - Ramassage: ${collectionAmount}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Mois</th>
                                <th>Enseignant</th>
                                <th>Identifiant</th>
                                <th>Montant</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (let month = 1; month <= 10; month++) {
                const teacherIndex = order[month - 1] - 1;
                const teacher = teachers[teacherIndex];
                const amount = groupValue;
                
                // Enregistrer les gains
                if (groupValue === 1000) teacher.gains1000 += amount * 10;
                else if (groupValue === 2000) teacher.gains2000 += amount * 10;
                else if (groupValue === 5000) teacher.gains5000 += amount * 10;
                else if (groupValue === 10000) teacher.gains10000 += amount * 10;
                
                // Enregistrer la collection
                if (!teacher.collections) teacher.collections = [];
                teacher.collections.push({
                    month: month,
                    group: groupValue,
                    amount: amount * 10
                });
                
                tableHTML += `
                    <tr>
                        <td>Mois ${month}</td>
                        <td>${teacher.name}</td>
                        <td>${teacher.identifier}</td>
                        <td>${(amount * 10).toLocaleString()} FCFA</td>
                    </tr>
                `;
            }
            
            tableHTML += `</tbody></table></div>`;
            return tableHTML;
        }

        function filterByTeacher() {
            currentFilter.teacher = document.getElementById('teacherFilter').value;
            showTeacherDetails();
        }

        function filterByMonth() {
            currentFilter.month = document.getElementById('monthFilter').value;
            showTeacherDetails();
        }

        function filterByGroup() {
            currentFilter.group = document.getElementById('groupFilter').value;
            showTeacherDetails();
        }

        function showTeacherDetails() {
            if (!programGenerated) return;
            
            const teacherDetails = document.getElementById('teacherDetails');
            teacherDetails.innerHTML = '';
            
            let filteredTeachers = currentFilter.teacher === 'all' 
                ? teachers 
                : teachers.filter(t => t.id == currentFilter.teacher);
            
            filteredTeachers.forEach(teacher => {
                let filteredCollections = teacher.collections || [];
                
                if (currentFilter.month !== 'all') {
                    filteredCollections = filteredCollections.filter(c => c.month == currentFilter.month);
                }
                if (currentFilter.group !== 'all') {
                    filteredCollections = filteredCollections.filter(c => c.group == currentFilter.group);
                }
                
                const totalCotisations = 180000; // 1000+2000+5000+10000 = 180000
                const totalRamassages = teacher.collections ? 
                    teacher.collections.reduce((sum, c) => sum + c.amount, 0) : 0;
                
                let detailsHTML = `
                    <div class="teacher-details">
                        <div class="teacher-header">
                            <h3><i class="fas fa-user"></i> ${teacher.name}</h3>
                            <button class="btn btn-purple no-print" onclick="printTeacher(${teacher.id})">
                                <i class="fas fa-print"></i> Imprimer fiche
                            </button>
                        </div>
                        
                        <p><strong><i class="fas fa-id-card"></i> Identifiant:</strong> ${teacher.identifier}</p>
                        <p><strong><i class="fas fa-key"></i> Mot de passe:</strong> ${teacher.password}</p>
                        
                        <div class="summary-card">
                            <h4><i class="fas fa-coins"></i> Cotisations totales</h4>
                            <p>1000 FCFA × 10 mois: <strong>10 000 FCFA</strong></p>
                            <p>2000 FCFA × 10 mois: <strong>20 000 FCFA</strong></p>
                            <p>5000 FCFA × 10 mois: <strong>50 000 FCFA</strong></p>
                            <p>10000 FCFA × 10 mois: <strong>100 000 FCFA</strong></p>
                            <p><strong>Total cotisations:</strong> 180 000 FCFA</p>
                        </div>
                `;
                
                if (filteredCollections.length > 0) {
                    detailsHTML += `
                        <div class="table-responsive">
                            <h4><i class="fas fa-calendar-check"></i> Ramassages</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Mois</th>
                                        <th>Groupe</th>
                                        <th>Montant</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    let totalFiltered = 0;
                    filteredCollections.forEach(c => {
                        totalFiltered += c.amount;
                        detailsHTML += `
                            <tr>
                                <td>Mois ${c.month}</td>
                                <td>${c.group} FCFA</td>
                                <td>${c.amount.toLocaleString()} FCFA</td>
                            </tr>
                        `;
                    });
                    
                    detailsHTML += `
                                </tbody>
                            </table>
                        </div>
                        <div class="summary-card">
                            <p><strong>Total ramassages (filtrés):</strong> ${totalFiltered.toLocaleString()} FCFA</p>
                        </div>
                    `;
                } else {
                    detailsHTML += `<p>Aucun ramassage pour ces filtres.</p>`;
                }
                
                detailsHTML += `
                    <div class="summary-card">
                        <h4><i class="fas fa-balance-scale"></i> Bilan</h4>
                        <p><strong>Total tous ramassages:</strong> ${totalRamassages.toLocaleString()} FCFA</p>
                        <p><strong>Solde net:</strong> ${(totalRamassages - totalCotisations).toLocaleString()} FCFA</p>
                    </div>
                    
                    <!-- Graphique de répartition mensuelle pour cet enseignant -->
                    <div class="chart-container no-print">
                        <h4><i class="fas fa-chart-line"></i> Répartition mensuelle des gains</h4>
                        <canvas id="teacherChart-${teacher.id}" style="max-height: 300px;"></canvas>
                    </div>
                </div>`;
                
                teacherDetails.innerHTML += detailsHTML;
            });
            
            // Créer les graphiques pour chaque enseignant affiché
            setTimeout(() => {
                filteredTeachers.forEach(teacher => {
                    createTeacherChart(teacher);
                });
            }, 100);
        }

        function createTeacherChart(teacher) {
            const canvasId = `teacherChart-${teacher.id}`;
            const canvas = document.getElementById(canvasId);
            
            if (!canvas) return;
            
            // Détruire l'ancien graphique s'il existe
            if (teacherCharts[teacher.id]) {
                teacherCharts[teacher.id].destroy();
            }
            
            // Préparer les données
            const months = ['Mois 1', 'Mois 2', 'Mois 3', 'Mois 4', 'Mois 5', 'Mois 6', 'Mois 7', 'Mois 8', 'Mois 9', 'Mois 10'];
            const monthlyData = new Array(10).fill(0);
            
            if (teacher.collections) {
                teacher.collections.forEach(c => {
                    monthlyData[c.month - 1] += c.amount;
                });
            }
            
            // Créer le graphique
            const ctx = canvas.getContext('2d');
            teacherCharts[teacher.id] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Montant perçu (FCFA)',
                        data: monthlyData,
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toLocaleString() + ' FCFA';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' F';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createGlobalCharts() {
            document.getElementById('globalCharts').style.display = 'block';
            
            // Graphique de répartition par groupe
            const groupCtx = document.getElementById('globalGroupChart').getContext('2d');
            const groupData = {
                '1000 FCFA': 0,
                '2000 FCFA': 0,
                '5000 FCFA': 0,
                '10000 FCFA': 0
            };
            
            teachers.forEach(teacher => {
                if (teacher.collections) {
                    teacher.collections.forEach(c => {
                        if (c.group === 1000) groupData['1000 FCFA'] += c.amount;
                        else if (c.group === 2000) groupData['2000 FCFA'] += c.amount;
                        else if (c.group === 5000) groupData['5000 FCFA'] += c.amount;
                        else if (c.group === 10000) groupData['10000 FCFA'] += c.amount;
                    });
                }
            });
            
            new Chart(groupCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(groupData),
                    datasets: [{
                        data: Object.values(groupData),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} FCFA (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Graphique d'évolution mensuelle globale
            const monthlyCtx = document.getElementById('globalMonthlyChart').getContext('2d');
            const monthlyData = new Array(10).fill(0);
            
            teachers.forEach(teacher => {
                if (teacher.collections) {
                    teacher.collections.forEach(c => {
                        monthlyData[c.month - 1] += c.amount;
                    });
                }
            });
            
            new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Mois 1', 'Mois 2', 'Mois 3', 'Mois 4', 'Mois 5', 'Mois 6', 'Mois 7', 'Mois 8', 'Mois 9', 'Mois 10'],
                    datasets: [{
                        label: 'Total des gains (FCFA)',
                        data: monthlyData,
                        borderColor: 'rgba(79, 70, 229, 1)',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toLocaleString() + ' FCFA';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' F';
                                }
                            }
                        }
                    }
                }
            });
        }

        function printTeacher(teacherId) {
            const originalFilter = {...currentFilter};
            
            currentFilter.teacher = teacherId;
            currentFilter.month = 'all';
            currentFilter.group = 'all';
            
            document.getElementById('teacherFilter').value = teacherId;
            document.getElementById('monthFilter').value = 'all';
            document.getElementById('groupFilter').value = 'all';
            
            showTeacherDetails();
            
            setTimeout(() => {
                window.print();
                
                currentFilter = originalFilter;
                document.getElementById('teacherFilter').value = originalFilter.teacher;
                document.getElementById('monthFilter').value = originalFilter.month;
                document.getElementById('groupFilter').value = originalFilter.group;
                
                setTimeout(() => showTeacherDetails(), 100);
            }, 500);
        }

        function printFilteredTeachers() {
            window.print();
        }

        // Fonction d'export CSV
        function exportAllToCSV() {
            if (teachers.length === 0) {
                showMessage('Aucune donnée à exporter', false);
                return;
            }

            let csvContent = "";
            
            // 1. En-têtes du fichier
            csvContent += "=== TONTINE ENSEIGNANTS - RAPPORT COMPLET ===\n";
            csvContent += `Date d'export: ${new Date().toLocaleString()}\n\n`;
            
            // 2. Liste des enseignants
            csvContent += "=== LISTE DES ENSEIGNANTS ===\n";
            csvContent += "ID;Nom;Identifiant;Mot de passe;Gains 1000F;Gains 2000F;Gains 5000F;Gains 10000F;Total Gains\n";
            
            teachers.forEach(teacher => {
                const totalGains = (teacher.gains1000 || 0) + (teacher.gains2000 || 0) + 
                                   (teacher.gains5000 || 0) + (teacher.gains10000 || 0);
                
                csvContent += `${teacher.id};${teacher.name};${teacher.identifier};${teacher.password};` +
                             `${teacher.gains1000 || 0};${teacher.gains2000 || 0};` +
                             `${teacher.gains5000 || 0};${teacher.gains10000 || 0};${totalGains}\n`;
            });
            
            csvContent += "\n";
            
            // 3. Programme de tontine par groupe
            const groups = [
                { name: "Groupe 1000 FCFA", value: 1000 },
                { name: "Groupe 2000 FCFA", value: 2000 },
                { name: "Groupe 5000 FCFA", value: 5000 },
                { name: "Groupe 10000 FCFA", value: 10000 }
            ];
            
            groups.forEach(group => {
                csvContent += `=== ${group.name} ===\n`;
                csvContent += "Mois;Enseignant;Identifiant;Montant\n";
                
                // Filtrer les collections pour ce groupe
                const groupCollections = [];
                teachers.forEach(teacher => {
                    if (teacher.collections) {
                        teacher.collections
                            .filter(c => c.group === group.value)
                            .forEach(c => {
                                groupCollections.push({
                                    month: c.month,
                                    teacher: teacher.name,
                                    identifier: teacher.identifier,
                                    amount: c.amount
                                });
                            });
                    }
                });
                
                // Trier par mois
                groupCollections.sort((a, b) => a.month - b.month);
                
                groupCollections.forEach(c => {
                    csvContent += `${c.month};${c.teacher};${c.identifier};${c.amount}\n`;
                });
                
                csvContent += "\n";
            });
            
            // 4. Récapitulatif des gains par enseignant
            csvContent += "=== RÉCAPITULATIF DES GAINS ===\n";
            csvContent += "Enseignant;Gains 1000F;Gains 2000F;Gains 5000F;Gains 10000F;Total Gains;Cotisations;Solde net\n";
            
            teachers.forEach(teacher => {
                const totalGains = (teacher.gains1000 || 0) + (teacher.gains2000 || 0) + 
                                   (teacher.gains5000 || 0) + (teacher.gains10000 || 0);
                const cotisations = 180000; // 1000+2000+5000+10000 = 180000
                const solde = totalGains - cotisations;
                
                csvContent += `${teacher.name};${teacher.gains1000 || 0};${teacher.gains2000 || 0};` +
                             `${teacher.gains5000 || 0};${teacher.gains10000 || 0};${totalGains};` +
                             `${cotisations};${solde}\n`;
            });
            
            // 5. Détail des ramassages par enseignant
            csvContent += "\n=== DÉTAIL DES RAMASSAGES PAR ENSEIGNANT ===\n";
            
            teachers.forEach(teacher => {
                if (teacher.collections && teacher.collections.length > 0) {
                    csvContent += `\n--- ${teacher.name} ---\n`;
                    csvContent += "Mois;Groupe;Montant\n";
                    
                    teacher.collections
                        .sort((a, b) => a.month - b.month)
                        .forEach(c => {
                            csvContent += `${c.month};${c.group} FCFA;${c.amount} FCFA\n`;
                        });
                    
                    const totalTeacher = teacher.collections.reduce((sum, c) => sum + c.amount, 0);
                    csvContent += `Total;${totalTeacher} FCFA\n`;
                }
            });
            
            // Créer et télécharger le fichier CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `tontine_enseignants_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('Export CSV effectué avec succès !');
        }

        // Sauvegarde avant de quitter
        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>
